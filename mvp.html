<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SmartCare Prototype — Soft Blue</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<style>
  /* ---------- Fonts & Theme ---------- */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

  :root {
    --soft-bg: #f4f8ff;
    --blue-600: #2e6bff;
    --blue-500: #4a86ff;
    --blue-200: #dfeeff;
    --card: #ffffff;
    --muted: #475569;
    --danger: #ef4444;
    --success: #16a34a;
    --radius: 18px;
    --btn-radius: 14px;
    --hold-ms: 2500;
  }

  html, body {
    margin: 0;
    height: 100%;
    font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: linear-gradient(180deg, var(--soft-bg) 0%, #eef6ff 100%);
  }

  /* ---------- Phone Frame ---------- */
  .phone-frame {
    width: 100%;
    max-width: 420px;
    height: 860px;
    border-radius: 28px;
    overflow: hidden;
    background: linear-gradient(180deg, rgba(255,255,255,0.85), #f5faff);
    border: 1px solid rgba(46,86,255,0.06);
    box-shadow: 0 18px 40px rgba(15,23,42,0.12);
    display: flex;
    flex-direction: column;
    position: relative;
  }

  header#app-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    gap: 8px;
    background: linear-gradient(90deg, var(--blue-200), #e3f0ff);
  }

  .header-left, .header-right {
    width: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .header-center {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  #logo {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    object-fit: cover;
    box-shadow: 0 6px 18px rgba(46,107,255,0.08);
    border: 2px solid white;
  }

  #header-title {
    color: #053067;
    font-weight: 700;
    font-size: 18px;
    margin-top: 6px;
  }

  main#app-screen {
    flex: 1;
    padding: 18px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .h1-title { font-size: 20px; font-weight: 800; color: #053067; }
  .h2-subtitle { font-size: 16px; font-weight: 700; color: var(--muted); }
  .body-text { font-size: 15px; color: var(--muted); line-height: 1.5; }

  .card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 14px;
    box-shadow: 0 6px 18px rgba(10,30,80,0.04);
    border: 1px solid rgba(10,30,80,0.03);
  }

  .app-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    border-radius: var(--btn-radius);
    font-weight: 700;
    padding: 12px 14px;
    cursor: pointer;
    font-size: 15px;
    user-select: none;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  }

  .app-btn:active { transform: translateY(1px) scale(.997); }
  .app-btn:focus { outline: 3px solid rgba(74,134,255,0.18); outline-offset: 2px; }

  .btn-primary { background: linear-gradient(180deg, var(--blue-500), var(--blue-600)); color: white; border: none; }
  .btn-soft { background: var(--blue-200); color: #063061; border: none; }
  .btn-ghost { background: transparent; color: #064e9b; border: 1px solid rgba(10,30,80,0.06); }

  #emergency-wrap { position: relative; width: 100%; }
  #emergency-btn { width: 100%; padding: 16px; border-radius: 16px; font-weight: 800; color: white; display: flex; gap: 12px; align-items: center; justify-content: center; background: linear-gradient(180deg,#ff7b7b,#ef4444); }
  #hold-progress { position: absolute; top: 12px; right: 12px; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; pointer-events: none; }
  svg.progress { transform: rotate(-90deg); }

  #alert-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; padding: 20px; z-index: 60; background: linear-gradient(180deg, rgba(2,6,23,0.35), rgba(2,6,23,0.5)); }
  #alert-card { width: 100%; max-width: 380px; background: linear-gradient(180deg,#fff7f7,#fff1f1); border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 18px 40px rgba(239,68,68,0.12); border: 1px solid rgba(239,68,68,0.06); }

  .bubble { padding: 10px 14px; border-radius: 18px; display: inline-block; max-width: 82%; font-size: 15px; }
  .bubble-me { background: linear-gradient(180deg,var(--blue-500),var(--blue-600)); color: white; border-bottom-right-radius: 6px; }
  .bubble-other { background: #f1f5f9; color: #0f172a; border-bottom-left-radius: 6px; }

  .muted { color: var(--muted); }
  .text-center { text-align: center; }
  .mt-2 { margin-top: 8px; }
  .mt-4 { margin-top: 14px; }

  .scale-105 { transform: scale(1.05); }
  .pulse-slow { animation: pulse 1.4s ease-in-out infinite; }
  @keyframes pulse { 0% { transform: scale(1);} 50% { transform: scale(1.04);} 100% { transform: scale(1);} }

  @media (min-width: 420px) { .phone-frame { transform: scale(1); } }
</style>
</head>
<body>

<div class="phone-frame" role="application" aria-label="SmartCare Prototype">
  <!-- Header -->
  <header id="app-header">
    <div class="header-left">
      <button id="back-btn" class="app-btn btn-ghost" onclick="goBack()" style="display:none;">
        <i data-lucide="chevron-left" class="w-5 h-5"></i>
      </button>
    </div>
    <div class="header-center">
      <img id="logo" src="https://github.com/adawiyahh/SmartCare/blob/main/logo%202%20SmartCare.jpg?raw=true" alt="SmartCare logo">
      <div id="header-title">SmartCare</div>
    </div>
    <div class="header-right"></div>
  </header>

  <!-- Main App Screen -->
  <main id="app-screen" tabindex="0" aria-live="polite"></main>

  <!-- Alert Overlay -->
  <div id="alert-overlay" class="hidden" role="alertdialog" aria-modal="true">
    <div id="alert-card">
      <i data-lucide="shield-alert" class="w-14 h-14 text-red-600 mb-2"></i>
      <div class="h1-title" style="color: var(--danger)">EMERGENCY</div>
      <div class="body-text mt-2">Fall detected for <strong id="overlay-elder"></strong>. A caregiver was notified.</div>
      <div class="mt-4 flex flex-col gap-3">
        <button class="app-btn btn-primary" onclick="resolveAlert('Elder')"><i data-lucide="check-circle"></i> I'm okay — Cancel</button>
        <button class="app-btn btn-soft" onclick="simulateCallToCaregiver()"><i data-lucide="phone-call"></i> Call caregiver</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-8 z-50 hidden">
    <div class="card bg-[#071033] text-white px-4 py-2 rounded-lg">Notification</div>
  </div>
</div>

<script>
// ================= SmartCare App =================

const STORAGE_KEY = 'smartcare_app_state_v3';
let appState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
  role: null,
  screen: 'roleSelect',
  history: [],
  isFallDetected: false,
  elderName: "Theo James",
  caregiverName: "Adrubyjane",
  medications: [
    { id:1, name:"Metformin (Diabetes)", dose:"500mg", time:"8:00 AM", taken:false },
    { id:2, name:"Lisinopril (BP)", dose:"10mg", time:"6:00 PM", taken:false },
    { id:3, name:"Vitamin D", dose:"1 tablet", time:"8:00 PM", taken:false }
  ],
  chatMessages: [
    { id:1, user:'Adrubyjane', role:'caregiver', text:'Good morning! Did you sleep well?', timestamp:'09:00' },
    { id:2, user:'Theo James', role:'elder', text:'Yes, I slept fine, thanks!', timestamp:'09:05' }
  ]
};

function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(appState)); }

function showToast(text, ms=2200){
  const t = document.getElementById('toast');
  t.querySelector('div').textContent = text;
  t.classList.remove('hidden');
  setTimeout(()=>t.classList.add('hidden'), ms);
}

function pushHistory(screen){
  if(!appState.history.length || appState.history.at(-1) !== screen) appState.history.push(screen);
  saveState();
}

function setScreen(screen, push=true){
  if(push && appState.screen && appState.screen !== 'roleSelect') pushHistory(appState.screen);
  appState.screen = screen;
  saveState();
  renderApp();
}

function goBack(){
  if(appState.history.length) appState.screen = appState.history.pop();
  else appState.screen = 'roleSelect';
  saveState();
  renderApp();
}

function selectRole(role){
  appState.role = role;
  setScreen('home');
  showToast(`Signed in as ${role}`);
}

function markMedicationTaken(id){
  const med = appState.medications.find(m => m.id===id);
  if(!med || med.taken) return;
  med.taken = true;
  const ts = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  appState.chatMessages.push({id:Date.now(), user: appState.elderName, role:'elder', text:`I just took ${med.name}`, timestamp:ts});
  saveState();
  showToast('Marked as taken');
  renderApp(false);
}

function sendMessage(preset=null){
  const input = document.getElementById('chat-input');
  let text = preset || (input ? input.value.trim() : '');
  if(!text) return;
  const ts = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  appState.chatMessages.push({id:Date.now(), user: appState.role==='elder'? appState.elderName: appState.caregiverName, role: appState.role, text, timestamp: ts});
  if(input) input.value = '';
  saveState();
  setScreen('chat', false);
}

function simulateFall(){
  if(appState.isFallDetected) return;
  appState.isFallDetected = true;
  document.getElementById('overlay-elder').textContent = appState.elderName;
  const ts = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  appState.chatMessages.push({id:Date.now(), user:'SYSTEM ALERT', role:'system', text:`*** FALL: ${appState.elderName} detected fall. Caregiver notified. ***`, timestamp:ts});
  saveState();
  setScreen(appState.role==='caregiver'?'alert':'home', false);
  showToast('Fall detected — caregiver notified (simulated)');
  renderApp();
}

function resolveAlert(by){
  appState.isFallDetected = false;
  const ts = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  const resolutionText = by==='Elder' ? 'Elder confirmed OK.' : 'Caregiver resolved alert.';
  appState.chatMessages.push({id:Date.now(), user:'SYSTEM ALERT', role:'system', text:`*** ALERT RESOLVED: ${resolutionText} ***`, timestamp:ts});
  saveState();
  setScreen('home', false);
  showToast('Alert resolved');
  renderApp();
}

function simulateCallToCaregiver(){
  showToast(`Calling ${appState.caregiverName} (simulated)`);
}

// -------- Hold-to-trigger emergency --------
const HOLD_MS = 2500;
let holdData = { timer:null, start:0, interval:null, triggered:false };

function startHoldForEmergency(evt){
  if(evt.pointerType==='mouse' && evt.button!==0) return;
  cancelHoldForEmergency();
  holdData.start = performance.now();
  holdData.triggered = false;

  const btn = document.getElementById('emergency-btn');
  const circle = document.getElementById('progress-ring');

  if(circle){
    const c = 2 * Math.PI * 18;
    circle.style.strokeDasharray = `${c} ${c}`;
    circle.style.strokeDashoffset = `${c}`;
  }

  holdData.interval = setInterval(()=>{
    const percent = Math.min(1, (performance.now()-holdData.start)/HOLD_MS);
    if(circle) circle.style.strokeDashoffset = 2*Math.PI*18*(1-percent);
    if(percent>=1 && !holdData.triggered){ holdData.triggered=true; simulateFall(); cancelHoldForEmergency(); }
  },50);

  holdData.timer = setTimeout(()=>{
    if(!holdData.triggered){ holdData.triggered=true; simulateFall(); cancelHoldForEmergency(); }
  }, HOLD_MS+50);

  if(evt.target && evt.pointerId) evt.target.setPointerCapture && evt.target.setPointerCapture(evt.pointerId);
}

function cancelHoldForEmergency(evt){
  clearTimeout(holdData.timer);
  clearInterval(holdData.interval);
  holdData.timer = holdData.interval = null;
  holdData.start = 0;
  holdData.triggered = false;

  const btn = document.getElementById('emergency-btn');
  const circle = document.getElementById('progress-ring');
  btn && btn.classList.remove('active','scale-105');
  if(circle) circle.style.strokeDashoffset = 2*Math.PI*18;
}

// -------- Renderers --------
function renderApp(){
  const app = document.getElementById('app-screen');
  updateHeader();
  let html = '';
  switch(appState.screen){
    case 'roleSelect': html = renderRoleSelect(); break;
    case 'home': html = appState.role==='elder'? renderElderHome() : renderCaregiverHome(); break;
    case 'meds': html = renderElderMedication(); break;
    case 'chat': html = renderChat(); break;
    case 'alert': html = renderFallAlert(); break;
    default: html = renderRoleSelect();
  }
  app.innerHTML = html;
  lucide.createIcons();
  if(appState.screen==='chat'){ const box=document.getElementById('chat-messages'); if(box) box.scrollTop=box.scrollHeight; document.getElementById('chat-input')?.focus(); }
  document.getElementById('alert-overlay').classList.toggle('hidden', !appState.isFallDetected);
}

// -------- Header Update --------
function updateHeader(){
  const backBtn=document.getElementById('back-btn');
  const title=document.getElementById('header-title');
  if(appState.screen==='roleSelect'){ backBtn.style.display='none'; title.textContent='SmartCare'; }
  else { backBtn.style.display='flex'; title.textContent= {'home':appState.role==='elder'?'My Dashboard':'Care Dashboard','meds':'Medication','chat':'Chat','alert':'Fall Alert'}[appState.screen] || 'SmartCare'; }
  document.getElementById('app-header').style.background = appState.role==='caregiver'? 'linear-gradient(90deg,#e6f7ff,#d7ecff)':'linear-gradient(90deg,#e6f0ff,#cfe3ff)';
}

// -------- Role Select Renderer --------
function renderRoleSelect(){ return `
  <div class="flex flex-col h-full justify-center items-center gap-3">
    <i data-lucide="heart-handshake" class="w-20 h-20 text-blue-500"></i>
    <div class="h1-title mt-2">Who are you?</div>
    <div class="body-text mt-2 muted">Choose a role to continue</div>
    <div class="mt-4 w-full">
      <button class="app-btn btn-primary w-full mb-3" onclick="selectRole('elder')">
        <i data-lucide="person-standing" class="w-5 h-5"></i> Elder — ${appState.elderName}
      </button>
      <button class="app-btn btn-soft w-full" onclick="selectRole('caregiver')">
        <i data-lucide="user-check" class="w-5 h-5"></i> Caregiver — ${appState.caregiverName}
      </button>
    </div>
    <div class="muted text-center mt-4 text-sm">Tip: Press and hold the red emergency button on Home for 2.5s to trigger an alert.</div>
  </div>
`;}

// Additional renderers (renderElderHome, renderCaregiverHome, renderElderMedication, renderChat, renderFallAlert) remain largely unchanged
// They can be copied from your original code or optimized similarly.

document.addEventListener('DOMContentLoaded', ()=>{ renderApp(); });
window.addEventListener('load', ()=>{ lucide.createIcons(); });
</script>

</body>
</html>

